<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Suwayda Incidents – Interactive Video Map</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <!-- MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; }
    .app { display: grid; grid-template-columns: 340px 1fr; grid-template-rows: 64px 1fr; height: 100vh; }
    header { grid-column: 1 / -1; display:flex; align-items:center; justify-content:space-between; padding: 10px 14px; border-bottom: 1px solid #e5e7eb; gap: 10px; }
    header h1 { font-size: 18px; margin: 0; }
    #sidebar { border-right: 1px solid #e5e7eb; padding: 12px; overflow:auto; }
    #map { width: 100%; height: 100%; min-height: 480px; position: relative; }

    .actions { display:flex; flex-wrap: wrap; gap:8px; align-items:center; }
    .field { margin-bottom: 10px; }
    label { font-size: 13px; color: #111827; display:block; margin-bottom: 4px; }
    input, select { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; }
    .chips { display:flex; flex-wrap: wrap; gap:6px; }
    .chip { padding:6px 10px; border-radius:999px; border:1px solid #d1d5db; font-size:12px; cursor:pointer; }
    .chip.active { background:#111827; color:white; border-color:#111827; }

    .legend { font-size: 12px; line-height:1.4; }
    .legend .row { display:flex; align-items:center; gap:8px; margin:4px 0; }
    .dot { width:10px; height:10px; border-radius:50%; display:inline-block; }

    .popup { width: 320px; }
    .popup h3 { margin: 0 0 8px; font-size: 14px; }
    .meta { font-size: 12px; color: #4b5563; margin-bottom: 8px; }
    .thumb-wrap { position: relative; border-radius: 10px; overflow: hidden; background:#000; }
    .thumb-wrap video, .thumb-wrap img { display:block; width:100%; height:auto; }
    .badge { position:absolute; top:8px; left:8px; background:rgba(17,24,39,.9); color:#fff; font-size:11px; padding:4px 6px; border-radius:6px; }
    .consent { margin-top:8px; font-size:11px; color:#6b7280; }

    .footer { font-size: 12px; color:#6b7280; }
    .btn { display:inline-flex; align-items:center; gap:6px; padding: 8px 10px; border-radius: 10px; border:1px solid #d1d5db; background:white; cursor:pointer; font-size: 13px; }
    .btn:hover { background:#f9fafb; }
    .btn.primary { background:#111827; color:#fff; border-color:#111827; }

    /* Admin panel */
    #adminPanel { position:absolute; right:16px; top:80px; width:360px; background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.08); padding:12px; display:none; z-index:5000; }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>Suwayda Incidents – Interactive Video Map</h1>
    <div class="actions">
      <input id="dataUrl" style="min-width:280px" placeholder="https://example.org/incidents.json" />
      <button id="fetchBtn" class="btn">Fetch JSON</button>
      <input id="dataFile" type="file" accept="application/json" style="display:none" />
      <button id="uploadBtn" class="btn">Load JSON file…</button>
      <button id="fitBtn" class="btn">Fit to Results</button>
      <button id="resetBtn" class="btn">Reset Filters</button>
      <button id="adminBtn" class="btn">Admin: Add incident</button>
    </div>
  </header>

  <aside id="sidebar">
    <div class="field">
      <label for="q">Search (title/notes)</label>
      <input id="q" type="search" placeholder="e.g., checkpoint, aid, shelling" />
    </div>

    <div class="field">
      <label>Date range</label>
      <div style="display:flex; gap:8px">
        <input id="from" type="date" />
        <input id="to" type="date" />
      </div>
    </div>

    <div class="field">
      <label>Incident types</label>
      <div id="typeChips" class="chips"></div>
    </div>

    <div class="field legend">
      <div class="row"><span class="dot" style="background:#ef4444"></span> Violence / Executions</div>
      <div class="row"><span class="dot" style="background:#3b82f6"></span> Siege / Aid denial</div>
      <div class="row"><span class="dot" style="background:#f59e0b"></span> Detention / Abduction</div>
      <div class="row"><span class="dot" style="background:#10b981"></span> Protest / Demonstration</div>
    </div>

    <div class="footer">
      <p><strong>Safety:</strong> Videos should be redacted and metadata removed. Originals stored securely.</p>
    </div>
  </aside>

  <main id="map">
    <!-- Admin Panel -->
    <div id="adminPanel">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px;">
        <strong>Admin – Add Incident</strong>
        <button id="closeAdmin" class="btn">Close</button>
      </div>

      <div class="field"><label>Click on the map to set location</label>
        <div id="adminCoords" style="font-size:12px;color:#6b7280">lat: —, lng: —</div>
      </div>

      <div class="field"><label>Title</label><input id="a_title" placeholder="Short description"/></div>
      <div class="field"><label>Type</label>
        <select id="a_type">
          <option value="violence">Violence / Executions</option>
          <option value="siege">Siege / Aid denial</option>
          <option value="detention">Detention / Abduction</option>
          <option value="protest">Protest / Demonstration</option>
        </select>
      </div>
      <div class="field"><label>Date</label><input id="a_date" type="date"/></div>
      <div class="field"><label>Video URL</label><input id="a_video" placeholder="videos/clip.mp4 or https://..."/></div>
      <div class="field"><label>Source (optional)</label><input id="a_source" placeholder="e.g., tg:@username"/></div>
      <div class="field"><label>Consent</label>
        <select id="a_consent"><option>public</option><option>press</option><option>private</option></select>
      </div>
      <div class="field"><label>Notes (optional)</label><input id="a_notes" placeholder="Faces blurred, etc."/></div>

      <div style="display:flex; gap:8px;">
        <button id="a_save" class="btn primary">Save to Map</button>
        <button id="a_download" class="btn">Download JSON</button>
      </div>
    </div>
  </main>
</div>

<!-- Leaflet JS -->
<script src="htt
